import { NextResponse } from 'next/server'; import { prisma } from '@/lib/prisma'; import { getSession } from '@/lib/session'; export async function GET(){ const s=await getSession(); if(!s.user) return new NextResponse('Unauthorized',{status:401}); const items=await prisma.contact.findMany({ where:{ userId:s.user.id } }); const header='type,name,email,phone,taxNo,address\n'; const lines=items.map(i=>[i.type,i.name,i.email||'',i.phone||'',i.taxNo||'',(i.address||'').replace(/\n/g,' ')].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')); return new NextResponse(header+lines.join('\n'),{ headers:{'Content-Type':'text/csv; charset=utf-8','Content-Disposition':'attachment; filename=contacts.csv'} }); }