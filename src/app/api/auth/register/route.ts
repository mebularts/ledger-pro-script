import { NextRequest, NextResponse } from 'next/server'; import { prisma } from '@/lib/prisma'; import bcrypt from 'bcryptjs'; import { getSession } from '@/lib/session'; export async function POST(req:NextRequest){ const {email,password}=await req.json(); if(!email||!password) return NextResponse.json({message:'Email and password required'},{status:400}); const exists=await prisma.user.findUnique({where:{email}}); if(exists) return NextResponse.json({message:'Email already in use'},{status:409}); const passwordHash=await bcrypt.hash(password,10); const user=await prisma.user.create({data:{email,passwordHash}}); const s=await getSession(); s.user={id:user.id,email:user.email,name:user.name??undefined}; await s.save(); return NextResponse.json({ok:true}); }
