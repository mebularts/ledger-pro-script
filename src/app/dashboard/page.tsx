'use client'; import { useEffect,useState } from 'react'; import { money } from '@/lib/format'; import { useLang } from '@/i18n/lang'; type KPI={income:number;expense:number;invoices:number;contacts:number}; export default function Dashboard(){ const {t}=useLang(); const [kpi,setKpi]=useState<KPI>({income:0,expense:0,invoices:0,contacts:0}); useEffect(()=>{ Promise.all([fetch('/api/payments').then(r=>r.json()).catch(()=>({items:[]})),fetch('/api/invoices').then(r=>r.json()).catch(()=>({items:[]})),fetch('/api/contacts').then(r=>r.json()).catch(()=>({items:[]})),]).then(([p,i,c])=>{ const income=(p.items||[]).filter((x:any)=>['INCOME','COLLECTION'].includes(x.type)).reduce((s:any,x:any)=>s+Number(x.amount||0),0); const expense=(p.items||[]).filter((x:any)=>['EXPENSE','OUTGOING'].includes(x.type)).reduce((s:any,x:any)=>s+Number(x.amount||0),0); setKpi({income,expense,invoices:(i.items||[]).length,contacts:(c.items||[]).length}); }); },[]); return (<div className='grid gap-6'><div className='grid md:grid-cols-4 gap-4'><div className='card'><div className='text-sm text-zinc-500'>{t('income')}</div><div className='text-2xl font-semibold'>{money(kpi.income)}</div></div><div className='card'><div className='text-sm text-zinc-500'>{t('expense')}</div><div className='text-2xl font-semibold'>{money(kpi.expense)}</div></div><div className='card'><div className='text-sm text-zinc-500'>{t('invoicesCount')}</div><div className='text-2xl font-semibold'>{kpi.invoices}</div></div><div className='card'><div className='text-sm text-zinc-500'>{t('contactsCount')}</div><div className='text-2xl font-semibold'>{kpi.contacts}</div></div></div><div className='card'><h2 className='font-semibold mb-2'>{t('quickActions')}</h2><div className='flex flex-wrap gap-2'><a className='btn btn-primary' href='/contacts'>{t('newContact')}</a><a className='btn' href='/invoices'>{t('newInvoice')}</a><a className='btn' href='/payments'>{t('newPayment')}</a><a className='btn' href='/ledger'>{t('newLedger')}</a><a className='btn' href='/api/export/contacts.csv'>Export Contacts (CSV)</a></div></div></div>); }
